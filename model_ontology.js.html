

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> model/ontology.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="doc-style.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
             
                <a class="image" href="index.html">
                    <img src="assets/img/icon.png" alt="logo">
                </a>
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Grapholscape</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-Settings.html">
                                Settings
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-Themes.html">
                                Themes
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/obdasystems/grapholscape"
                        >
                            Github
                        </a>
                    
                        <a
                            class="link user-link "
                            href="./demo/index.html"
                        >
                            Demo
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="Diagram.html">Diagram</a></li><li><a href="Grapholscape.html">Grapholscape</a></li><li><a href="Namespace.html">Namespace</a></li><li><a href="Ontology.html">Ontology</a></li><li><a href="RendererManager.html">RendererManager</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bareGrapholscape">bareGrapholscape</a></li><li><a href="global.html#constructorLabels">constructorLabels</a></li><li><a href="global.html#fullGrapholscape">fullGrapholscape</a></li><li><a href="global.html#Shape">Shape</a></li><li><a href="global.html#Type">Type</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>model/ontology.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** 
 * @typedef {object} Iri
 * @property {string} Iri.fullIri
 * @property {string} Iri.remainingChars the string after the namespace or prefix
 * @property {string} Iri.prefix
 * @property {string} Iri.prefixed
 * @property {string} Iri.namespace
 */ 
 
/** 
 * @typedef {object} Position
 * @property {number} Position.x
 * @property {number} Position.y
 */

/**
 * @typedef {Object.&lt;string, string[]>} Annotation
 */
 
/**
 * @typedef {object} GrapholElem
 * @property {Position} position
 * @property {string} classes
 * @property {"nodes"|"edges"} group
 * @property {boolean} grabbable
 * @property {boolean} locked
 * @property {boolean} pannable
 * @property {boolean} removed
 * @property {boolean} selectable
 * @property {boolean} selected
 * @property {ElemData} data
 */ 
 
/** 
 * @typedef {object} ElemData the data related to the diagram elements: nodes or edges
 * @property {number} diagram_id the id owning this element
 * @property {string} displayed_name the name displayed in the diagram
 * @property {string} fillColor color of the node body
 * @property {string} fontSize the size of the displayed name
 * @property {number} height
 * @property {number} width
 * @property {Object&lt;string, Annotation>} annotations map &lt;annotationKind, Annotation> where annotationKind can be `label`, `comment` etc..
 * @property {Iri} iri
 * @property {string} id unique id in the ontology [id]+_+[diagram_id]
 * @property {string} id_xml the parsed id (not unique in the ontology)
 * @property {import('./node-enums').Types} identity
 * @property {Types} type the type of node
 * @property {boolean?} labelXcentered whether to center node's label on node's body along X axis
 * @property {boolean?} labelYcentered whether to center node's label on node's body along X axis
 * @property {number} labelXpos offset position of the node's label in case it's not centered along X
 * @property {number} labelYpos offset position of the node's label in case it's not centered along Y
 * @property {import('./node-enums').Shape} shape the shape of the node
 * @property {string[]?} inputs [property-assertion] list of id_xml
 * //edge
 * @property {string?} source [edge] the id of the source node
 * @property {string?} target [edge] the id of the target node
 * @property {Position[]?} breakpoints [edge] a list of edge's breakpoints positions
 * @property {number[]?} segment_distances [edge] read more about segment-distances(https://js.cytoscape.org/#style/unbundled-bezier-edges)
 * @property {number[]?} segment_weights [edge] read more about segment-weights (https://js.cytoscape.org/#style/unbundled-bezier-edges)
 * @property {number[]?} source_endpoint [edge] position of the endpoint on source node
 * @property {number[]?} target_endpoint [edge] position of the endpoint on target node
 * // Object/DataProperties
 * @property {boolean?} functional
 * @property {boolean?} inverseFunctional
 * @property {boolean?} symmetric
 * @property {boolean?} asymmetric
 * @property {boolean?} reflexive
 * @property {boolean?} irreflexive
 * @property {boolean?} transitive
 */
 
/** 
 * @typedef {import('cytoscape').CollectionReturnValue} CollectionReturnValue 
 */

import Diagram from './diagram'
import Namespace from './namespace'
/**
 * # Ontology
 * Class used as the Model of the whole app.
 */
class Ontology {
  /**
   * @param {string} name
   * @param {string} version
   * @param {Namespace[]} namespaces
   * @param {Diagram[]} diagrams
   */
  constructor(name, version, namespaces = [], diagrams = []) {
    /** @type {string} */
    this.name = name
    /** @type {string} */
    this.version = version
    /** @type {Namespace[]} */
    this.namespaces = namespaces
    /** @type {Diagram[]} */
    this.diagrams = diagrams

    /** @type {Object.&lt;string, Annotation>} */
    this.annotations = []
    
    this.languages = { 
      /** @type {import('../grapholscape').Language[]}*/
      list: [], 
      default: ''
    }
    /** @type {Annotation} */
    this.description = []
  }

  /** @param {Namespace} namespace */
  addNamespace(namespace) {
    this.namespaces.push(namespace)
  }

  /**
   * Get the Namspace object given its IRI string
   * @param {string} iriValue the IRI assigned to the namespace
   * @returns {Namespace}
   */
  getNamespace(iriValue) {
    return this.namespaces.find(ns => ns.value === iriValue)
  }

  /**
   * Get the Namespace given one of its prefixes
   * @param {string} prefix 
   * @returns {Namespace}
   */
  getNamespaceFromPrefix(prefix) {
    return this.namespaces.find(ns => ns.hasPrefix(prefix))
  }

  /**
   * Get 
   * @param {string} iri full iri
   * @returns {Iri | undefined}
   */
  destructureIri(iri) {
    for (let namespace of this.namespaces) {
      // if iri contains namespace 
      if (iri.includes(namespace.value)) {
        return {
          namespace: namespace.value,
          prefix: namespace.prefixes[0],
          fullIri: iri,
          remainingChars: iri.slice(namespace.value.length),
          prefixed:  namespace.prefixes[0] + ':' + iri.slice(namespace.value.length)
        }
      }
    }
  }

  /** @param {Diagram} diagram */
  addDiagram(diagram) {
    this.diagrams.push(diagram)
  }

  /**
   * @param {string | number} index the id or the name of the diagram
   * @returns {Diagram} The diagram object
   */
  getDiagram(index) {
    if (index &lt; 0 || index > this.diagrams.length) return
    if (this.diagrams[index]) return this.diagrams[index]

    return this.diagrams.find(d => d.name.toLowerCase() === index?.toString().toLowerCase())
  }

  /**
   * Get an element in the ontology by id, searching in every diagram
   * @param {string} elem_id - The `id` of the elem to retrieve
   * @returns {CollectionReturnValue} The cytoscape object representation.
   */
  getElem(elem_id) {
    for (let diagram of this.diagrams) {
      let node = diagram.cy.$id(elem_id)
      if (node.length > 0) return node
    }
  }

  /**
   * Retrieve an entity by its IRI.
   * @param {string} iri - The IRI in full or prefixed form.
   * i.e. : `grapholscape:world` or `https://examples/grapholscape/world`
   * @returns {CollectionReturnValue} The cytoscape object representation.
   */
  getEntity(iri) {
    if (this.getEntityOccurrences(iri)) return this.getEntityOccurrences(iri)[0]
  }

  /**
   * Retrieve all occurrences of an entity by its IRI.
   * @param {string} iri - The IRI in full or prefixed form.
   * i.e. : `grapholscape:world` or `https://examples/grapholscape/world`
   * @returns {CollectionReturnValue[]} An array of cytoscape object representation
   */
  getEntityOccurrences(iri) {
    return this.entities[iri] || this.entities[this.prefixedToFullIri(iri)]
  }

  /**
   * Get an element in the ontology by its id and its diagram id
   * @param {string} elemID - The id of the element to retrieve
   * @param {string } diagramID - the id of the diagram containing the element
   * @returns {CollectionReturnValue} The element in cytoscape object representation
   */
  getElemByDiagramAndId(elemID, diagramID) {
    let diagram = this.getDiagram(diagramID)

    if (diagram) {
      let node = diagram.cy.$(`[id_xml = "${elemID}"]`) || diagram.cy.$id(elemID)
      if (node.length > 0)
        return node
    }
  }

  /**
   * Get the entities in the ontology
   * @returns {Object.&lt;string, CollectionReturnValue[]>} a map of IRIs, with an array of entity occurrences (object[iri].occurrences)
   */
  getEntities() {
    let entities = {}
    this.diagrams.forEach(diagram => {
      diagram.cy.$('.predicate').forEach(entity => {
        let iri = entity.data('iri').fullIri

        if (!Object.keys(entities).includes(iri)) {
          entities[iri] = []
        }

        entities[iri].push(entity)
      })
    })

    this._entities = entities
    return entities
  }

  /**
   * Check if entity has the specified iri in full or prefixed form
   * @param {Entity} entity 
   * @param {string} iri
   * @returns {boolean}
   */
  checkEntityIri(entity, iri) {
    /** @type {Iri} */
    let entityIri = entity.data('iri') || entity.data.iri
    return entityIri.fullIri === iri ||
      entityIri.prefixed === iri
  }

  /**
   * Retrieve the full IRI given a prefixed IRI
   * @param {string} prefixedIri a prefixed IRI
   * @returns {string} full IRI
   */
  prefixedToFullIri(prefixedIri) {
    if (!prefixedIri || typeof(prefixedIri) !== 'string') return
    for (let namespace of this.namespaces) {
      let prefix = namespace.prefixes.find( p => prefixedIri.includes(p + ':'))

      if (prefix) return prefixedIri.replace(prefix + ':', namespace.value)

      else if (prefixedIri.startsWith(':') &amp;&amp; namespace.prefixes.some( p => p === '')) {
        return prefixedIri.replace(':', namespace.value)
      }
    }
  }

  get isEntitiesEmpty() { return (!this._entities || Object.keys(this._entities).length === 0) }

  get entities() { return this.isEntitiesEmpty ? this.getEntities() : this._entities}
}

export default Ontology</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>

</body>
</html>
